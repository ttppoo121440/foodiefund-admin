import{b as C,g as J,k as ke,c as j,d as Je}from"./@babel-D4-ut-Uz.js";import{n as qe,t as De,g as b,a as Me,v as Ye,b as te}from"./@rc-component-DkdjcAXV.js";import{c as ue}from"./classnames-BaEkKJlL.js";import{B as ze,t as Ge}from"./rc-input-CK5FyHxW.js";import{r as t}from"./react-Bi3d65_o.js";import{b as Qe,q as Y,H as Xe,I as Ze,J as ae,f as _e}from"./rc-util-C7705Oj_.js";function en(n){var i=n.prefixCls,s=n.upNode,k=n.downNode,x=n.upDisabled,g=n.downDisabled,y=n.onStep,E=t.useRef(),d=t.useRef([]),N=t.useRef();N.current=y;var l=function(){clearTimeout(E.current)},h=function(p,A){p.preventDefault(),l(),N.current(A),E.current=setTimeout(function z(){N.current(A),E.current=setTimeout(z,200)},600)};if(t.useEffect(function(){return function(){l(),d.current.forEach(function(p){return Y.cancel(p)})}},[]),Xe())return null;var c="".concat(i,"-handler"),q=ue(c,"".concat(c,"-up"),C({},"".concat(c,"-up-disabled"),x)),I=ue(c,"".concat(c,"-down"),C({},"".concat(c,"-down-disabled"),g)),S=function(){return d.current.push(Y(l))},m={unselectable:"on",role:"button",onMouseUp:S,onMouseLeave:S};return t.createElement("div",{className:"".concat(c,"-wrap")},t.createElement("span",J({},m,{onMouseDown:function(p){h(p,!0)},"aria-label":"Increase Value","aria-disabled":x,className:q}),s||t.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-up-inner")})),t.createElement("span",J({},m,{onMouseDown:function(p){h(p,!1)},"aria-label":"Decrease Value","aria-disabled":g,className:I}),k||t.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-down-inner")})))}function Te(n){var i=typeof n=="number"?qe(n):De(n).fullStr;return i.includes(".")?De(i.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:n+"0"}var nn=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","changeOnWheel","controls","classNames","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep","changeOnBlur","domRef"],rn=["disabled","style","prefixCls","value","prefix","suffix","addonBefore","addonAfter","className","classNames"],Be=function(n,i){return n||i.isEmpty()?i.toString():i.toNumber()},Oe=function(n){var i=b(n);return i.isInvalidate()?null:i},tn=t.forwardRef(function(n,i){var s=n.prefixCls,k=n.className,x=n.style,g=n.min,y=n.max,E=n.step,d=E===void 0?1:E,N=n.defaultValue,l=n.value,h=n.disabled,c=n.readOnly,q=n.upHandler,I=n.downHandler,S=n.keyboard,m=n.changeOnWheel,p=m!==void 0&&m,A=n.controls,z=A===void 0||A;n.classNames;var oe=n.stringMode,P=n.parser,D=n.formatter,M=n.precision,T=n.decimalSeparator,ie=n.onChange,ce=n.onInput,le=n.onPressEnter,se=n.onStep,fe=n.changeOnBlur,Ae=fe===void 0||fe,He=n.domRef,Ue=ke(n,nn),de="".concat(s,"-input"),H=t.useRef(null),We=t.useState(!1),pe=j(We,2),G=pe[0],me=pe[1],w=t.useRef(!1),U=t.useRef(!1),F=t.useRef(!1),Ve=t.useState(function(){return b(l??N)}),ve=j(Ve,2),o=ve[0],be=ve[1],Q=t.useCallback(function(e,r){if(!r)return M>=0?M:Math.max(Me(e),Me(d))},[M,d]),X=t.useCallback(function(e){var r=String(e);if(P)return P(r);var a=r;return T&&(a=a.replace(T,".")),a.replace(/[^\w.-]+/g,"")},[P,T]),Z=t.useRef(""),ge=t.useCallback(function(e,r){if(D)return D(e,{userTyping:r,input:String(Z.current)});var a=typeof e=="number"?qe(e):e;if(!r){var u=Q(a,r);Ye(a)&&(T||u>=0)&&(a=te(a,T||".",u))}return a},[D,Q,T]),Ke=t.useState(function(){var e=N??l;return o.isInvalidate()&&["string","number"].includes(Je(e))?Number.isNaN(e)?"":e:ge(o.toString(),!1)}),Ne=j(Ke,2),W=Ne[0],Ee=Ne[1];function V(e,r){Ee(ge(e.isInvalidate()?e.toString(!1):e.toString(!r),r))}Z.current=W;var R,he,K,_,ee,B=t.useMemo(function(){return Oe(y)},[y,M]),O=t.useMemo(function(){return Oe(g)},[g,M]),we=t.useMemo(function(){return!(!B||!o||o.isInvalidate())&&B.lessEquals(o)},[B,o]),xe=t.useMemo(function(){return!(!O||!o||o.isInvalidate())&&o.lessEquals(O)},[O,o]),Le=(R=H.current,he=G,K=t.useRef(null),[function(){try{var e=R.selectionStart,r=R.selectionEnd,a=R.value,u=a.substring(0,e),f=a.substring(r);K.current={start:e,end:r,value:a,beforeTxt:u,afterTxt:f}}catch{}},function(){if(R&&K.current&&he)try{var e=R.value,r=K.current,a=r.beforeTxt,u=r.afterTxt,f=r.start,v=e.length;if(e.startsWith(a))v=a.length;else if(e.endsWith(u))v=e.length-K.current.afterTxt.length;else{var L=a[f-1],Ie=e.indexOf(L,f-1);Ie!==-1&&(v=Ie+1)}R.setSelectionRange(v,v)}catch(je){Qe(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(je.message))}}]),ye=j(Le,2),Pe=ye[0],Fe=ye[1],Se=function(e){return B&&!e.lessEquals(B)?B:O&&!O.lessEquals(e)?O:null},ne=function(e){return!Se(e)},$=function(e,r){var a,u=e,f=ne(u)||u.isEmpty();if(u.isEmpty()||r||(u=Se(u)||u,f=!0),!c&&!h&&f){var v=u.toString(),L=Q(v,r);return L>=0&&(u=b(te(v,".",L)),ne(u)||(u=b(te(v,".",L,!0)))),u.equals(o)||(a=u,l===void 0&&be(a),ie==null||ie(u.isEmpty()?null:Be(oe,u)),l===void 0&&V(u,r)),u}return o},$e=(_=t.useRef(0),ee=function(){Y.cancel(_.current)},t.useEffect(function(){return ee},[]),function(e){ee(),_.current=Y(function(){e()})}),Re=function e(r){if(Pe(),Z.current=r,Ee(r),!U.current){var a=X(r),u=b(a);u.isNaN()||$(u,!0)}ce==null||ce(r),$e(function(){var f=r;P||(f=r.replace(/ã€‚/g,".")),f!==r&&e(f)})},re=function(e){var r;if(!(e&&we||!e&&xe)){w.current=!1;var a=b(F.current?Te(d):d);e||(a=a.negate());var u=(o||b(0)).add(a.toString()),f=$(u,!1);se==null||se(Be(oe,f),{offset:F.current?Te(d):d,type:e?"up":"down"}),(r=H.current)===null||r===void 0||r.focus()}},Ce=function(e){var r,a=b(X(W));r=a.isNaN()?$(o,e):$(a,e),l!==void 0?V(o,!1):r.isNaN()||V(r,!1)};return t.useEffect(function(){if(p&&G){var e=function(a){re(a.deltaY<0),a.preventDefault()},r=H.current;if(r)return r.addEventListener("wheel",e,{passive:!1}),function(){return r.removeEventListener("wheel",e)}}}),ae(function(){o.isInvalidate()||V(o,!1)},[M,D]),ae(function(){var e=b(l);be(e);var r=b(X(W));e.equals(r)&&w.current&&!D||V(e,w.current)},[l]),ae(function(){D&&Fe()},[W]),t.createElement("div",{ref:He,className:ue(s,k,C(C(C(C(C({},"".concat(s,"-focused"),G),"".concat(s,"-disabled"),h),"".concat(s,"-readonly"),c),"".concat(s,"-not-a-number"),o.isNaN()),"".concat(s,"-out-of-range"),!o.isInvalidate()&&!ne(o))),style:x,onFocus:function(){me(!0)},onBlur:function(){Ae&&Ce(!1),me(!1),w.current=!1},onKeyDown:function(e){var r=e.key,a=e.shiftKey;w.current=!0,F.current=a,r==="Enter"&&(U.current||(w.current=!1),Ce(!1),le==null||le(e)),S!==!1&&!U.current&&["Up","ArrowUp","Down","ArrowDown"].includes(r)&&(re(r==="Up"||r==="ArrowUp"),e.preventDefault())},onKeyUp:function(){w.current=!1,F.current=!1},onCompositionStart:function(){U.current=!0},onCompositionEnd:function(){U.current=!1,Re(H.current.value)},onBeforeInput:function(){w.current=!0}},z&&t.createElement(en,{prefixCls:s,upNode:q,downNode:I,upDisabled:we,downDisabled:xe,onStep:re}),t.createElement("div",{className:"".concat(de,"-wrap")},t.createElement("input",J({autoComplete:"off",role:"spinbutton","aria-valuemin":g,"aria-valuemax":y,"aria-valuenow":o.isInvalidate()?null:o.toString(),step:d},Ue,{ref:_e(H,i),className:de,value:W,onChange:function(e){Re(e.target.value)},disabled:h,readOnly:c}))))}),fn=t.forwardRef(function(n,i){var s=n.disabled,k=n.style,x=n.prefixCls,g=x===void 0?"rc-input-number":x,y=n.value,E=n.prefix,d=n.suffix,N=n.addonBefore,l=n.addonAfter,h=n.className,c=n.classNames,q=ke(n,rn),I=t.useRef(null),S=t.useRef(null),m=t.useRef(null);return t.useImperativeHandle(i,function(){return Ze(m.current,{nativeElement:I.current.nativeElement||S.current})}),t.createElement(ze,{className:h,triggerFocus:function(p){m.current&&Ge(m.current,p)},prefixCls:g,value:y,disabled:s,style:k,prefix:E,suffix:d,addonAfter:l,addonBefore:N,classNames:c,components:{affixWrapper:"div",groupWrapper:"div",wrapper:"div",groupAddon:"div"},ref:I},t.createElement(tn,J({prefixCls:g,disabled:s,ref:m,domRef:S,className:c==null?void 0:c.input},q)))});export{fn as I};
