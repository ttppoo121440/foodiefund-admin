import{r as p}from"./react-Bi3d65_o.js";import{e as w,m as Z,n as W,f as x,b as u,d as Q,k as fe,g as xe,h as Ue,i as Te,_ as ge,a as he,j as M,c as X}from"./@babel-D4-ut-Uz.js";import{b as D,p as B,F as H,G as j,n as be,x as We}from"./rc-util-C7705Oj_.js";import{S as _e}from"./@rc-component-DkdjcAXV.js";var q="RC_FORM_INTERNAL_HOOKS",R=function(){D(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},K=p.createContext({getFieldValue:R,getFieldsValue:R,getFieldError:R,getFieldWarning:R,getFieldsError:R,isFieldsTouched:R,isFieldTouched:R,isFieldValidating:R,isFieldsValidating:R,resetFields:R,setFields:R,setFieldValue:R,setFieldsValue:R,validateFields:R,submit:R,getInternalHooks:function(){return R(),{dispatch:R,initEntityValue:R,registerField:R,useSubscribe:R,setInitialValues:R,destroyForm:R,setCallbacks:R,registerWatch:R,getFields:R,setValidateMessages:R,setPreserve:R,getInitialValue:R}}}),re=p.createContext(null);function oe(o){return o==null?[]:Array.isArray(o)?o:[o]}var U="'${name}' is not a valid ${type}",Me={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:U,method:U,array:U,object:U,number:U,date:U,boolean:U,integer:U,float:U,regexp:U,email:U,url:U,hex:U},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},ke=_e;function je(o,c){return o.replace(/\\?\$\{\w+\}/g,function(t){if(t.startsWith("\\"))return t.slice(1);var r=t.slice(2,-1);return c[r]})}var Ee="CODE_LOGIC_ERROR";function ue(o,c,t,r,e){return le.apply(this,arguments)}function le(){return le=Z(W().mark(function o(c,t,r,e,n){var i,a,l,s,d,h,E,b,y;return W().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return delete(i=w({},r)).ruleIndex,ke.warning=function(){},i.validator&&(a=i.validator,i.validator=function(){try{return a.apply(void 0,arguments)}catch(k){return console.error(k),Promise.reject(Ee)}}),l=null,i&&i.type==="array"&&i.defaultField&&(l=i.defaultField,delete i.defaultField),s=new ke(u({},c,[i])),d=B(Me,e.validateMessages),s.messages(d),h=[],f.prev=10,f.next=13,Promise.resolve(s.validate(u({},c,t),w({},e)));case 13:f.next=18;break;case 15:f.prev=15,f.t0=f.catch(10),f.t0.errors&&(h=f.t0.errors.map(function(k,V){var g=k.message,m=g===Ee?d.default:g;return p.isValidElement(m)?p.cloneElement(m,{key:"error_".concat(V)}):m}));case 18:if(h.length||!l){f.next=23;break}return f.next=21,Promise.all(t.map(function(k,V){return ue("".concat(c,".").concat(V),k,l,e,n)}));case 21:return E=f.sent,f.abrupt("return",E.reduce(function(k,V){return[].concat(x(k),x(V))},[]));case 23:return b=w(w({},r),{},{name:c,enum:(r.enum||[]).join(", ")},n),y=h.map(function(k){return typeof k=="string"?je(k,b):k}),f.abrupt("return",y);case 26:case"end":return f.stop()}},o,null,[[10,15]])})),le.apply(this,arguments)}function De(o,c,t,r,e,n){var i,a=o.join("."),l=t.map(function(d,h){var E=d.validator,b=w(w({},d),{},{ruleIndex:h});return E&&(b.validator=function(y,f,k){var V=!1,g=E(y,f,function(){for(var m=arguments.length,N=new Array(m),C=0;C<m;C++)N[C]=arguments[C];Promise.resolve().then(function(){D(!V,"Your validator function has already return a promise. `callback` will be ignored."),V||k.apply(void 0,N)})});V=g&&typeof g.then=="function"&&typeof g.catch=="function",D(V,"`callback` is deprecated. Please return a promise instead."),V&&g.then(function(){k()}).catch(function(m){k(m||" ")})}),b}).sort(function(d,h){var E=d.warningOnly,b=d.ruleIndex,y=h.warningOnly,f=h.ruleIndex;return!!E==!!y?b-f:E?1:-1});if(e===!0)i=new Promise(function(){var d=Z(W().mark(function h(E,b){var y,f,k;return W().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:y=0;case 1:if(!(y<l.length)){V.next=12;break}return f=l[y],V.next=5,ue(a,c,f,r,n);case 5:if(!(k=V.sent).length){V.next=9;break}return b([{errors:k,rule:f}]),V.abrupt("return");case 9:y+=1,V.next=1;break;case 12:E([]);case 13:case"end":return V.stop()}},h)}));return function(h,E){return d.apply(this,arguments)}}());else{var s=l.map(function(d){return ue(a,c,d,r,n).then(function(h){return{errors:h,rule:d}})});i=(e?function(d){return Re.apply(this,arguments)}(s):function(d){return Ne.apply(this,arguments)}(s)).then(function(d){return Promise.reject(d)})}return i.catch(function(d){return d}),i}function Ne(){return(Ne=Z(W().mark(function o(c){return W().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(c).then(function(r){var e;return(e=[]).concat.apply(e,x(r))}));case 1:case"end":return t.stop()}},o)}))).apply(this,arguments)}function Re(){return(Re=Z(W().mark(function o(c){var t;return W().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=0,r.abrupt("return",new Promise(function(e){c.forEach(function(n){n.then(function(i){i.errors.length&&e([i]),(t+=1)===c.length&&e([])})})}));case 2:case"end":return r.stop()}},o)}))).apply(this,arguments)}function A(o){return oe(o)}function Pe(o,c){var t={};return c.forEach(function(r){var e=H(o,r);t=j(t,r,e)}),t}function J(o,c){var t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return o&&o.some(function(r){return Ie(c,r,t)})}function Ie(o,c){return!(!o||!c)&&!(!(arguments.length>2&&arguments[2]!==void 0&&arguments[2])&&o.length!==c.length)&&c.every(function(t,r){return o[r]===t})}function He(o){var c=arguments.length<=1?void 0:arguments[1];return c&&c.target&&Q(c.target)==="object"&&o in c.target?c.target[o]:c}function we(o,c,t){var r=o.length;if(c<0||c>=r||t<0||t>=r)return o;var e=o[c],n=c-t;return n>0?[].concat(x(o.slice(0,t)),[e],x(o.slice(t,c)),x(o.slice(c+1,r))):n<0?[].concat(x(o.slice(0,c)),x(o.slice(c+1,t+1)),[e],x(o.slice(t+1,r))):o}var qe=["name"],T=[];function ae(o,c,t,r,e,n){return typeof o=="function"?o(c,t,"source"in n?{source:n.source}:{}):r!==e}var ce=function(o){Ue(t,o);var c=Te(t);function t(r){var e;return he(this,t),e=c.call(this,r),u(M(e),"state",{resetCount:0}),u(M(e),"cancelRegisterFunc",null),u(M(e),"mounted",!1),u(M(e),"touched",!1),u(M(e),"dirty",!1),u(M(e),"validatePromise",void 0),u(M(e),"prevValidating",void 0),u(M(e),"errors",T),u(M(e),"warnings",T),u(M(e),"cancelRegister",function(){var n=e.props,i=n.preserve,a=n.isListField,l=n.name;e.cancelRegisterFunc&&e.cancelRegisterFunc(a,i,A(l)),e.cancelRegisterFunc=null}),u(M(e),"getNamePath",function(){var n=e.props,i=n.name,a=n.fieldContext.prefixName;return i!==void 0?[].concat(x(a===void 0?[]:a),x(i)):[]}),u(M(e),"getRules",function(){var n=e.props,i=n.rules,a=i===void 0?[]:i,l=n.fieldContext;return a.map(function(s){return typeof s=="function"?s(l):s})}),u(M(e),"refresh",function(){e.mounted&&e.setState(function(n){return{resetCount:n.resetCount+1}})}),u(M(e),"metaCache",null),u(M(e),"triggerMetaEvent",function(n){var i=e.props.onMetaChange;if(i){var a=w(w({},e.getMeta()),{},{destroy:n});be(e.metaCache,a)||i(a),e.metaCache=a}else e.metaCache=null}),u(M(e),"onStoreChange",function(n,i,a){var l=e.props,s=l.shouldUpdate,d=l.dependencies,h=d===void 0?[]:d,E=l.onReset,b=a.store,y=e.getNamePath(),f=e.getValue(n),k=e.getValue(b),V=i&&J(i,y);switch(a.type!=="valueUpdate"||a.source!=="external"||be(f,k)||(e.touched=!0,e.dirty=!0,e.validatePromise=null,e.errors=T,e.warnings=T,e.triggerMetaEvent()),a.type){case"reset":if(!i||V)return e.touched=!1,e.dirty=!1,e.validatePromise=void 0,e.errors=T,e.warnings=T,e.triggerMetaEvent(),E==null||E(),void e.refresh();break;case"remove":if(s&&ae(s,n,b,f,k,a))return void e.reRender();break;case"setField":var g=a.data;if(V)return"touched"in g&&(e.touched=g.touched),"validating"in g&&!("originRCField"in g)&&(e.validatePromise=g.validating?Promise.resolve([]):null),"errors"in g&&(e.errors=g.errors||T),"warnings"in g&&(e.warnings=g.warnings||T),e.dirty=!0,e.triggerMetaEvent(),void e.reRender();if("value"in g&&J(i,y,!0)||s&&!y.length&&ae(s,n,b,f,k,a))return void e.reRender();break;case"dependenciesUpdate":if(h.map(A).some(function(m){return J(a.relatedFields,m)}))return void e.reRender();break;default:if(V||(!h.length||y.length||s)&&ae(s,n,b,f,k,a))return void e.reRender()}s===!0&&e.reRender()}),u(M(e),"validateRules",function(n){var i=e.getNamePath(),a=e.getValue(),l=n||{},s=l.triggerName,d=l.validateOnly,h=d!==void 0&&d,E=Promise.resolve().then(Z(W().mark(function b(){var y,f,k,V,g,m,N;return W().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(e.mounted){C.next=2;break}return C.abrupt("return",[]);case 2:if(y=e.props,f=y.validateFirst,k=f!==void 0&&f,V=y.messageVariables,g=y.validateDebounce,m=e.getRules(),s&&(m=m.filter(function(v){return v}).filter(function(v){var F=v.validateTrigger;return!F||oe(F).includes(s)})),!g||!s){C.next=10;break}return C.next=8,new Promise(function(v){setTimeout(v,g)});case 8:if(e.validatePromise===E){C.next=10;break}return C.abrupt("return",[]);case 10:return(N=De(i,a,m,n,k,V)).catch(function(v){return v}).then(function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T;if(e.validatePromise===E){var F;e.validatePromise=null;var P=[],I=[];(F=v.forEach)===null||F===void 0||F.call(v,function($){var O=$.rule.warningOnly,_=$.errors,ee=_===void 0?T:_;O?I.push.apply(I,x(ee)):P.push.apply(P,x(ee))}),e.errors=P,e.warnings=I,e.triggerMetaEvent(),e.reRender()}}),C.abrupt("return",N);case 13:case"end":return C.stop()}},b)})));return h||(e.validatePromise=E,e.dirty=!0,e.errors=T,e.warnings=T,e.triggerMetaEvent(),e.reRender()),E}),u(M(e),"isFieldValidating",function(){return!!e.validatePromise}),u(M(e),"isFieldTouched",function(){return e.touched}),u(M(e),"isFieldDirty",function(){return!(!e.dirty&&e.props.initialValue===void 0)||(0,e.props.fieldContext.getInternalHooks(q).getInitialValue)(e.getNamePath())!==void 0}),u(M(e),"getErrors",function(){return e.errors}),u(M(e),"getWarnings",function(){return e.warnings}),u(M(e),"isListField",function(){return e.props.isListField}),u(M(e),"isList",function(){return e.props.isList}),u(M(e),"isPreserve",function(){return e.props.preserve}),u(M(e),"getMeta",function(){return e.prevValidating=e.isFieldValidating(),{touched:e.isFieldTouched(),validating:e.prevValidating,errors:e.errors,warnings:e.warnings,name:e.getNamePath(),validated:e.validatePromise===null}}),u(M(e),"getOnlyChild",function(n){if(typeof n=="function"){var i=e.getMeta();return w(w({},e.getOnlyChild(n(e.getControlled(),i,e.props.fieldContext))),{},{isFunction:!0})}var a=We(n);return a.length===1&&p.isValidElement(a[0])?{child:a[0],isFunction:!1}:{child:a,isFunction:!1}}),u(M(e),"getValue",function(n){var i=e.props.fieldContext.getFieldsValue,a=e.getNamePath();return H(n||i(!0),a)}),u(M(e),"getControlled",function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=e.props,a=i.name,l=i.trigger,s=i.validateTrigger,d=i.getValueFromEvent,h=i.normalize,E=i.valuePropName,b=i.getValueProps,y=i.fieldContext,f=s!==void 0?s:y.validateTrigger,k=e.getNamePath(),V=y.getInternalHooks,g=y.getFieldsValue,m=V(q).dispatch,N=e.getValue(),C=b||function(I){return u({},E,I)},v=n[l],F=a!==void 0?C(N):{},P=w(w({},n),F);return P[l]=function(){var I;e.touched=!0,e.dirty=!0,e.triggerMetaEvent();for(var $=arguments.length,O=new Array($),_=0;_<$;_++)O[_]=arguments[_];I=d?d.apply(void 0,O):He.apply(void 0,[E].concat(O)),h&&(I=h(I,N,g(!0))),m({type:"updateValue",namePath:k,value:I}),v&&v.apply(void 0,O)},oe(f||[]).forEach(function(I){var $=P[I];P[I]=function(){$&&$.apply(void 0,arguments);var O=e.props.rules;O&&O.length&&m({type:"validateField",namePath:k,triggerName:I})}}),P}),r.fieldContext&&(0,(0,r.fieldContext.getInternalHooks)(q).initEntityValue)(M(e)),e}return ge(t,[{key:"componentDidMount",value:function(){var r=this.props,e=r.shouldUpdate,n=r.fieldContext;if(this.mounted=!0,n){var i=(0,n.getInternalHooks)(q).registerField;this.cancelRegisterFunc=i(this)}e===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var r,e=this.state.resetCount,n=this.props.children,i=this.getOnlyChild(n),a=i.child;return i.isFunction?r=a:p.isValidElement(a)?r=p.cloneElement(a,this.getControlled(a.props)):(D(!a,"`children` of Field is not validate ReactElement."),r=a),p.createElement(p.Fragment,{key:e},r)}}]),t}(p.Component);function $e(o){var c=o.name,t=fe(o,qe),r=p.useContext(K),e=p.useContext(re),n=c!==void 0?A(c):void 0,i="keep";return t.isListField||(i="_".concat((n||[]).join("_"))),p.createElement(ce,xe({key:i,name:n,isListField:!!e},t,{fieldContext:r}))}function ze(o){var c=o.name,t=o.initialValue,r=o.children,e=o.rules,n=o.validateTrigger,i=o.isListField,a=p.useContext(K),l=p.useContext(re),s=p.useRef({keys:[],id:0}).current,d=p.useMemo(function(){var b=A(a.prefixName)||[];return[].concat(x(b),x(A(c)))},[a.prefixName,c]),h=p.useMemo(function(){return w(w({},a),{},{prefixName:d})},[a,d]),E=p.useMemo(function(){return{getKey:function(b){var y=d.length,f=b[y];return[s.keys[f],b.slice(y+1)]}}},[d]);return typeof r!="function"?(D(!1,"Form.List only accepts function as children."),null):p.createElement(re.Provider,{value:E},p.createElement(K.Provider,{value:h},p.createElement($e,{name:[],shouldUpdate:function(b,y,f){return f.source!=="internal"&&b!==y},rules:e,validateTrigger:n,initialValue:t,isList:!0,isListField:i??!!l},function(b,y){var f=b.value,k=f===void 0?[]:f,V=b.onChange,g=a.getFieldValue,m=function(){return g(d||[])||[]},N={add:function(v,F){var P=m();F>=0&&F<=P.length?(s.keys=[].concat(x(s.keys.slice(0,F)),[s.id],x(s.keys.slice(F))),V([].concat(x(P.slice(0,F)),[v],x(P.slice(F))))):(s.keys=[].concat(x(s.keys),[s.id]),V([].concat(x(P),[v]))),s.id+=1},remove:function(v){var F=m(),P=new Set(Array.isArray(v)?v:[v]);P.size<=0||(s.keys=s.keys.filter(function(I,$){return!P.has($)}),V(F.filter(function(I,$){return!P.has($)})))},move:function(v,F){if(v!==F){var P=m();v<0||v>=P.length||F<0||F>=P.length||(s.keys=we(s.keys,v,F),V(we(P,v,F)))}}},C=k||[];return Array.isArray(C)||(C=[]),r(C.map(function(v,F){var P=s.keys[F];return P===void 0&&(s.keys[F]=s.id,P=s.keys[F],s.id+=1),{name:F,key:P,isListField:!0}}),N,y)})))}u(ce,"contextType",K),u(ce,"defaultProps",{trigger:"onChange",valuePropName:"value"});var Ae="__@field_split__";function se(o){return o.map(function(c){return"".concat(Q(c),":").concat(c)}).join(Ae)}var G=function(){function o(){he(this,o),u(this,"kvs",new Map)}return ge(o,[{key:"set",value:function(c,t){this.kvs.set(se(c),t)}},{key:"get",value:function(c){return this.kvs.get(se(c))}},{key:"update",value:function(c,t){var r=t(this.get(c));r?this.set(c,r):this.delete(c)}},{key:"delete",value:function(c){this.kvs.delete(se(c))}},{key:"map",value:function(c){return x(this.kvs.entries()).map(function(t){var r=X(t,2),e=r[0],n=r[1],i=e.split(Ae);return c({key:i.map(function(a){var l=a.match(/^([^:]*):(.*)$/),s=X(l,3),d=s[1],h=s[2];return d==="number"?Number(h):h}),value:n})})}},{key:"toJSON",value:function(){var c={};return this.map(function(t){var r=t.key,e=t.value;return c[r.join(".")]=e,null}),c}}]),o}(),Ge=["name"],Je=ge(function o(c){var t=this;he(this,o),u(this,"formHooked",!1),u(this,"forceRootUpdate",void 0),u(this,"subscribable",!0),u(this,"store",{}),u(this,"fieldEntities",[]),u(this,"initialValues",{}),u(this,"callbacks",{}),u(this,"validateMessages",null),u(this,"preserve",null),u(this,"lastValidatePromise",null),u(this,"getForm",function(){return{getFieldValue:t.getFieldValue,getFieldsValue:t.getFieldsValue,getFieldError:t.getFieldError,getFieldWarning:t.getFieldWarning,getFieldsError:t.getFieldsError,isFieldsTouched:t.isFieldsTouched,isFieldTouched:t.isFieldTouched,isFieldValidating:t.isFieldValidating,isFieldsValidating:t.isFieldsValidating,resetFields:t.resetFields,setFields:t.setFields,setFieldValue:t.setFieldValue,setFieldsValue:t.setFieldsValue,validateFields:t.validateFields,submit:t.submit,_init:!0,getInternalHooks:t.getInternalHooks}}),u(this,"getInternalHooks",function(r){return r===q?(t.formHooked=!0,{dispatch:t.dispatch,initEntityValue:t.initEntityValue,registerField:t.registerField,useSubscribe:t.useSubscribe,setInitialValues:t.setInitialValues,destroyForm:t.destroyForm,setCallbacks:t.setCallbacks,setValidateMessages:t.setValidateMessages,getFields:t.getFields,setPreserve:t.setPreserve,getInitialValue:t.getInitialValue,registerWatch:t.registerWatch}):(D(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),u(this,"useSubscribe",function(r){t.subscribable=r}),u(this,"prevWithoutPreserves",null),u(this,"setInitialValues",function(r,e){if(t.initialValues=r||{},e){var n,i=B(r,t.store);(n=t.prevWithoutPreserves)===null||n===void 0||n.map(function(a){var l=a.key;i=j(i,l,H(r,l))}),t.prevWithoutPreserves=null,t.updateStore(i)}}),u(this,"destroyForm",function(r){if(r)t.updateStore({});else{var e=new G;t.getFieldEntities(!0).forEach(function(n){t.isMergedPreserve(n.isPreserve())||e.set(n.getNamePath(),!0)}),t.prevWithoutPreserves=e}}),u(this,"getInitialValue",function(r){var e=H(t.initialValues,r);return r.length?B(e):e}),u(this,"setCallbacks",function(r){t.callbacks=r}),u(this,"setValidateMessages",function(r){t.validateMessages=r}),u(this,"setPreserve",function(r){t.preserve=r}),u(this,"watchList",[]),u(this,"registerWatch",function(r){return t.watchList.push(r),function(){t.watchList=t.watchList.filter(function(e){return e!==r})}}),u(this,"notifyWatch",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(t.watchList.length){var e=t.getFieldsValue(),n=t.getFieldsValue(!0);t.watchList.forEach(function(i){i(e,n,r)})}}),u(this,"timeoutId",null),u(this,"warningUnhooked",function(){}),u(this,"updateStore",function(r){t.store=r}),u(this,"getFieldEntities",function(){return arguments.length>0&&arguments[0]!==void 0&&arguments[0]?t.fieldEntities.filter(function(r){return r.getNamePath().length}):t.fieldEntities}),u(this,"getFieldsMap",function(){var r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=new G;return t.getFieldEntities(r).forEach(function(n){var i=n.getNamePath();e.set(i,n)}),e}),u(this,"getFieldEntitiesForNamePathList",function(r){if(!r)return t.getFieldEntities(!0);var e=t.getFieldsMap(!0);return r.map(function(n){var i=A(n);return e.get(i)||{INVALIDATE_NAME_PATH:A(n)}})}),u(this,"getFieldsValue",function(r,e){var n,i,a;if(t.warningUnhooked(),r===!0||Array.isArray(r)?(n=r,i=e):r&&Q(r)==="object"&&(a=r.strict,i=r.filter),n===!0&&!i)return t.store;var l=t.getFieldEntitiesForNamePathList(Array.isArray(n)?n:null),s=[];return l.forEach(function(d){var h,E,b,y,f="INVALIDATE_NAME_PATH"in d?d.INVALIDATE_NAME_PATH:d.getNamePath();if(a){if((b=(y=d).isList)!==null&&b!==void 0&&b.call(y))return}else if(!n&&(h=(E=d).isListField)!==null&&h!==void 0&&h.call(E))return;if(i){var k="getMeta"in d?d.getMeta():null;i(k)&&s.push(f)}else s.push(f)}),Pe(t.store,s.map(A))}),u(this,"getFieldValue",function(r){t.warningUnhooked();var e=A(r);return H(t.store,e)}),u(this,"getFieldsError",function(r){return t.warningUnhooked(),t.getFieldEntitiesForNamePathList(r).map(function(e,n){return e&&!("INVALIDATE_NAME_PATH"in e)?{name:e.getNamePath(),errors:e.getErrors(),warnings:e.getWarnings()}:{name:A(r[n]),errors:[],warnings:[]}})}),u(this,"getFieldError",function(r){t.warningUnhooked();var e=A(r);return t.getFieldsError([e])[0].errors}),u(this,"getFieldWarning",function(r){t.warningUnhooked();var e=A(r);return t.getFieldsError([e])[0].warnings}),u(this,"isFieldsTouched",function(){t.warningUnhooked();for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];var i,a=e[0],l=e[1],s=!1;e.length===0?i=null:e.length===1?Array.isArray(a)?(i=a.map(A),s=!1):(i=null,s=a):(i=a.map(A),s=l);var d=t.getFieldEntities(!0),h=function(f){return f.isFieldTouched()};if(!i)return s?d.every(function(f){return h(f)||f.isList()}):d.some(h);var E=new G;i.forEach(function(f){E.set(f,[])}),d.forEach(function(f){var k=f.getNamePath();i.forEach(function(V){V.every(function(g,m){return k[m]===g})&&E.update(V,function(g){return[].concat(x(g),[f])})})});var b=function(f){return f.some(h)},y=E.map(function(f){return f.value});return s?y.every(b):y.some(b)}),u(this,"isFieldTouched",function(r){return t.warningUnhooked(),t.isFieldsTouched([r])}),u(this,"isFieldsValidating",function(r){t.warningUnhooked();var e=t.getFieldEntities();if(!r)return e.some(function(i){return i.isFieldValidating()});var n=r.map(A);return e.some(function(i){var a=i.getNamePath();return J(n,a)&&i.isFieldValidating()})}),u(this,"isFieldValidating",function(r){return t.warningUnhooked(),t.isFieldsValidating([r])}),u(this,"resetWithFieldInitialValue",function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=new G,n=t.getFieldEntities(!0);n.forEach(function(a){var l=a.props.initialValue,s=a.getNamePath();if(l!==void 0){var d=e.get(s)||new Set;d.add({entity:a,value:l}),e.set(s,d)}});var i;r.entities?i=r.entities:r.namePathList?(i=[],r.namePathList.forEach(function(a){var l,s=e.get(a);s&&(l=i).push.apply(l,x(x(s).map(function(d){return d.entity})))})):i=n,i.forEach(function(a){if(a.props.initialValue!==void 0){var l=a.getNamePath();if(t.getInitialValue(l)!==void 0)D(!1,"Form already set 'initialValues' with path '".concat(l.join("."),"'. Field can not overwrite it."));else{var s=e.get(l);if(s&&s.size>1)D(!1,"Multiple Field with path '".concat(l.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(s){var d=t.getFieldValue(l);a.isListField()||r.skipExist&&d!==void 0||t.updateStore(j(t.store,l,x(s)[0].value))}}}})}),u(this,"resetFields",function(r){t.warningUnhooked();var e=t.store;if(!r)return t.updateStore(B(t.initialValues)),t.resetWithFieldInitialValue(),t.notifyObservers(e,null,{type:"reset"}),void t.notifyWatch();var n=r.map(A);n.forEach(function(i){var a=t.getInitialValue(i);t.updateStore(j(t.store,i,a))}),t.resetWithFieldInitialValue({namePathList:n}),t.notifyObservers(e,n,{type:"reset"}),t.notifyWatch(n)}),u(this,"setFields",function(r){t.warningUnhooked();var e=t.store,n=[];r.forEach(function(i){var a=i.name,l=fe(i,Ge),s=A(a);n.push(s),"value"in l&&t.updateStore(j(t.store,s,l.value)),t.notifyObservers(e,[s],{type:"setField",data:i})}),t.notifyWatch(n)}),u(this,"getFields",function(){return t.getFieldEntities(!0).map(function(r){var e=r.getNamePath(),n=r.getMeta(),i=w(w({},n),{},{name:e,value:t.getFieldValue(e)});return Object.defineProperty(i,"originRCField",{value:!0}),i})}),u(this,"initEntityValue",function(r){var e=r.props.initialValue;if(e!==void 0){var n=r.getNamePath();H(t.store,n)===void 0&&t.updateStore(j(t.store,n,e))}}),u(this,"isMergedPreserve",function(r){var e=r!==void 0?r:t.preserve;return e==null||e}),u(this,"registerField",function(r){t.fieldEntities.push(r);var e=r.getNamePath();if(t.notifyWatch([e]),r.props.initialValue!==void 0){var n=t.store;t.resetWithFieldInitialValue({entities:[r],skipExist:!0}),t.notifyObservers(n,[r.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(i,a){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(t.fieldEntities=t.fieldEntities.filter(function(h){return h!==r}),!t.isMergedPreserve(a)&&(!i||l.length>1)){var s=i?void 0:t.getInitialValue(e);if(e.length&&t.getFieldValue(e)!==s&&t.fieldEntities.every(function(h){return!Ie(h.getNamePath(),e)})){var d=t.store;t.updateStore(j(d,e,s,!0)),t.notifyObservers(d,[e],{type:"remove"}),t.triggerDependenciesUpdate(d,e)}}t.notifyWatch([e])}}),u(this,"dispatch",function(r){switch(r.type){case"updateValue":var e=r.namePath,n=r.value;t.updateValue(e,n);break;case"validateField":var i=r.namePath,a=r.triggerName;t.validateFields([i],{triggerName:a})}}),u(this,"notifyObservers",function(r,e,n){if(t.subscribable){var i=w(w({},n),{},{store:t.getFieldsValue(!0)});t.getFieldEntities().forEach(function(a){(0,a.onStoreChange)(r,e,i)})}else t.forceRootUpdate()}),u(this,"triggerDependenciesUpdate",function(r,e){var n=t.getDependencyChildrenFields(e);return n.length&&t.validateFields(n),t.notifyObservers(r,n,{type:"dependenciesUpdate",relatedFields:[e].concat(x(n))}),n}),u(this,"updateValue",function(r,e){var n=A(r),i=t.store;t.updateStore(j(t.store,n,e)),t.notifyObservers(i,[n],{type:"valueUpdate",source:"internal"}),t.notifyWatch([n]);var a=t.triggerDependenciesUpdate(i,n),l=t.callbacks.onValuesChange;l&&l(Pe(t.store,[n]),t.getFieldsValue()),t.triggerOnFieldsChange([n].concat(x(a)))}),u(this,"setFieldsValue",function(r){t.warningUnhooked();var e=t.store;if(r){var n=B(t.store,r);t.updateStore(n)}t.notifyObservers(e,null,{type:"valueUpdate",source:"external"}),t.notifyWatch()}),u(this,"setFieldValue",function(r,e){t.setFields([{name:r,value:e}])}),u(this,"getDependencyChildrenFields",function(r){var e=new Set,n=[],i=new G;return t.getFieldEntities().forEach(function(a){(a.props.dependencies||[]).forEach(function(l){var s=A(l);i.update(s,function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return d.add(a),d})})}),function a(l){(i.get(l)||new Set).forEach(function(s){if(!e.has(s)){e.add(s);var d=s.getNamePath();s.isFieldDirty()&&d.length&&(n.push(d),a(d))}})}(r),n}),u(this,"triggerOnFieldsChange",function(r,e){var n=t.callbacks.onFieldsChange;if(n){var i=t.getFields();if(e){var a=new G;e.forEach(function(s){var d=s.name,h=s.errors;a.set(d,h)}),i.forEach(function(s){s.errors=a.get(s.name)||s.errors})}var l=i.filter(function(s){var d=s.name;return J(r,d)});l.length&&n(l,i)}}),u(this,"validateFields",function(r,e){var n,i;t.warningUnhooked(),Array.isArray(r)||typeof r=="string"||typeof e=="string"?(n=r,i=e):i=r;var a=!!n,l=a?n.map(A):[],s=[],d=String(Date.now()),h=new Set,E=i||{},b=E.recursive,y=E.dirty;t.getFieldEntities(!0).forEach(function(g){if(a||l.push(g.getNamePath()),g.props.rules&&g.props.rules.length&&(!y||g.isFieldDirty())){var m=g.getNamePath();if(h.add(m.join(d)),!a||J(l,m,b)){var N=g.validateRules(w({validateMessages:w(w({},Me),t.validateMessages)},i));s.push(N.then(function(){return{name:m,errors:[],warnings:[]}}).catch(function(C){var v,F=[],P=[];return(v=C.forEach)===null||v===void 0||v.call(C,function(I){var $=I.rule.warningOnly,O=I.errors;$?P.push.apply(P,x(O)):F.push.apply(F,x(O))}),F.length?Promise.reject({name:m,errors:F,warnings:P}):{name:m,errors:F,warnings:P}}))}}});var f=function(g){var m=!1,N=g.length,C=[];return g.length?new Promise(function(v,F){g.forEach(function(P,I){P.catch(function($){return m=!0,$}).then(function($){N-=1,C[I]=$,N>0||(m&&F(C),v(C))})})}):Promise.resolve([])}(s);t.lastValidatePromise=f,f.catch(function(g){return g}).then(function(g){var m=g.map(function(N){return N.name});t.notifyObservers(t.store,m,{type:"validateFinish"}),t.triggerOnFieldsChange(m,g)});var k=f.then(function(){return t.lastValidatePromise===f?Promise.resolve(t.getFieldsValue(l)):Promise.reject([])}).catch(function(g){var m=g.filter(function(N){return N&&N.errors.length});return Promise.reject({values:t.getFieldsValue(l),errorFields:m,outOfDate:t.lastValidatePromise!==f})});k.catch(function(g){return g});var V=l.filter(function(g){return h.has(g.join(d))});return t.triggerOnFieldsChange(V),k}),u(this,"submit",function(){t.warningUnhooked(),t.validateFields().then(function(r){var e=t.callbacks.onFinish;if(e)try{e(r)}catch(n){console.error(n)}}).catch(function(r){var e=t.callbacks.onFinishFailed;e&&e(r)})}),this.forceRootUpdate=c});function Le(o){var c=p.useRef(),t=p.useState({}),r=X(t,2)[1];if(!c.current)if(o)c.current=o;else{var e=new Je(function(){r({})});c.current=e.getForm()}return[c.current]}var de=p.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),Ke=function(o){var c=o.validateMessages,t=o.onFormChange,r=o.onFormFinish,e=o.children,n=p.useContext(de),i=p.useRef({});return p.createElement(de.Provider,{value:w(w({},n),{},{validateMessages:w(w({},n.validateMessages),c),triggerFormChange:function(a,l){t&&t(a,{changedFields:l,forms:i.current}),n.triggerFormChange(a,l)},triggerFormFinish:function(a,l){r&&r(a,{values:l,forms:i.current}),n.triggerFormFinish(a,l)},registerForm:function(a,l){a&&(i.current=w(w({},i.current),{},u({},a,l))),n.registerForm(a,l)},unregisterForm:function(a){var l=w({},i.current);delete l[a],i.current=l,n.unregisterForm(a)}})},e)},Ye=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed","clearOnDestroy"],Be=function(o,c){var t=o.name,r=o.initialValues,e=o.fields,n=o.form,i=o.preserve,a=o.children,l=o.component,s=l===void 0?"form":l,d=o.validateMessages,h=o.validateTrigger,E=h===void 0?"onChange":h,b=o.onValuesChange,y=o.onFieldsChange,f=o.onFinish,k=o.onFinishFailed,V=o.clearOnDestroy,g=fe(o,Ye),m=p.useRef(null),N=p.useContext(de),C=Le(n),v=X(C,1)[0],F=v.getInternalHooks(q),P=F.useSubscribe,I=F.setInitialValues,$=F.setCallbacks,O=F.setValidateMessages,_=F.setPreserve,ee=F.destroyForm;p.useImperativeHandle(c,function(){return w(w({},v),{},{nativeElement:m.current})}),p.useEffect(function(){return N.registerForm(t,v),function(){N.unregisterForm(t)}},[N,v,t]),O(w(w({},N.validateMessages),d)),$({onValuesChange:b,onFieldsChange:function(L){if(N.triggerFormChange(t,L),y){for(var S=arguments.length,te=new Array(S>1?S-1:0),z=1;z<S;z++)te[z-1]=arguments[z];y.apply(void 0,[L].concat(te))}},onFinish:function(L){N.triggerFormFinish(t,L),f&&f(L)},onFinishFailed:k}),_(i);var ne,ie=p.useRef(null);I(r,!ie.current),ie.current||(ie.current=!0),p.useEffect(function(){return function(){return ee(V)}},[]);var ve=typeof a=="function";ve?ne=a(v.getFieldsValue(!0),v):ne=a,P(!ve);var me=p.useRef();p.useEffect(function(){(function(L,S){if(L===S)return!0;if(!L&&S||L&&!S||!L||!S||Q(L)!=="object"||Q(S)!=="object")return!1;var te=Object.keys(L),z=Object.keys(S),Se=new Set([].concat(te,z));return x(Se).every(function(Fe){var ye=L[Fe],Ve=S[Fe];return typeof ye=="function"&&typeof Ve=="function"||ye===Ve})})(me.current||[],e||[])||v.setFields(e||[]),me.current=e},[e,v]);var Oe=p.useMemo(function(){return w(w({},v),{},{validateTrigger:E})},[v,E]),pe=p.createElement(re.Provider,{value:null},p.createElement(K.Provider,{value:Oe},ne));return s===!1?pe:p.createElement(s,xe({},g,{ref:m,onSubmit:function(L){L.preventDefault(),L.stopPropagation(),v.submit()},onReset:function(L){var S;L.preventDefault(),v.resetFields(),(S=g.onReset)===null||S===void 0||S.call(g,L)}}),pe)};function Ce(o){try{return JSON.stringify(o)}catch{return Math.random()}}function Qe(){for(var o=arguments.length,c=new Array(o),t=0;t<o;t++)c[t]=arguments[t];var r=c[0],e=c[1],n=e===void 0?{}:e,i=function(m){return m&&!!m._init}(n)?{form:n}:n,a=i.form,l=p.useState(),s=X(l,2),d=s[0],h=s[1],E=p.useMemo(function(){return Ce(d)},[d]),b=p.useRef(E);b.current=E;var y=p.useContext(K),f=a||y,k=f&&f._init,V=A(r),g=p.useRef(V);return g.current=V,p.useEffect(function(){if(k){var m=f.getFieldsValue,N=(0,f.getInternalHooks)(q).registerWatch,C=function(P,I){var $=i.preserve?I:P;return typeof r=="function"?r($):H($,g.current)},v=N(function(P,I){var $=C(P,I),O=Ce($);b.current!==O&&(b.current=O,h($))}),F=C(m(),m(!0));return d!==F&&h(F),v}},[k]),d}var Y=p.forwardRef(Be);Y.FormProvider=Ke,Y.Field=$e,Y.List=ze,Y.useForm=Le,Y.useWatch=Qe;export{K as C,Ke as F,re as L,Y as R,$e as W,ze as a,Qe as b,Le as u};
