var Me=Object.defineProperty;var Ne=(s,a,t)=>a in s?Me(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var xe=(s,a,t)=>(Ne(s,typeof a!="symbol"?a+"":a,t),t);import{j as e,r as c,a as Ye}from"./react-Bi3d65_o.js";import{c as Ve}from"./react-dom-DttoD7qq.js";import{L as W,B as We}from"./react-router-dom-CNkp-S8u.js";import{L as R,M as Qe,R as ne,C as O,a as ie,I as ue,D as $e,S as K,b as Ke,F as Re,c as z,d as je,e as $,f as Ue,g as H,T as Ge,B as U,h as fe,s as He,i as be,j as Je}from"./antd-ZU-628Uy.js";import{b as Xe,d as Ze,e as Q}from"./react-router-DeUjcAIS.js";import{T as et,U as ke,V as tt,W as at,X as st,Y as rt,Z as nt,w as it,_ as ve,$ as Se,a0 as ot}from"./@ant-design-DEQSkco9.js";import{L as lt,P as dt,B as Ie}from"./react-chartjs-2-DvCJRGMk.js";import{C as J,a as pe,b as me,c as ct,d as ut,p as ge,e as X,f as Z,A as pt,g as Ce}from"./chart.js-B7ur4JDz.js";import{u as M,C as V,b as we,F as Le}from"./react-hook-form-DrtPsZaK.js";import{t as le}from"./@hookform-D0evxqJq.js";import{d as T}from"./dayjs-DIA0-yFM.js";import{u as Ee,a as N,b as Y,Q as mt,c as gt}from"./@tanstack-BapjZGRO.js";import{a as ht}from"./axios-B4HuQH-i.js";import{z as n}from"./zod-Y5dSNMtF.js";import{h as de}from"./moment-CNBjaTJc.js";import"./classnames-BaEkKJlL.js";import"./scheduler-DTKAQvWo.js";import"./@remix-run-CPHcqyyx.js";import"./rc-util-C7705Oj_.js";import"./@babel-D4-ut-Uz.js";import"./rc-resize-observer-B6_Tj1-Q.js";import"./resize-observer-polyfill-BT-ZEh6l.js";import"./rc-motion-C1KiqwsE.js";import"./rc-overflow-bPcnyqg5.js";import"./rc-picker-M4028Ejg.js";import"./@rc-component-DkdjcAXV.js";import"./rc-tabs-DLe2bHTq.js";import"./rc-dropdown-Cq_zp985.js";import"./rc-menu-iHApGxUz.js";import"./rc-select-By_rEHyQ.js";import"./rc-virtual-list-MHoChsUk.js";import"./rc-input-number-B4gt17nH.js";import"./rc-input-CK5FyHxW.js";import"./@ctrl-YIyChsxa.js";import"./rc-field-form-DLWfUEiy.js";import"./scroll-into-view-if-needed-C9t9fFH4.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-dialog-D9zpP1gB.js";import"./rc-notification-C2jgTedp.js";import"./rc-switch-37w2GYbv.js";import"./rc-table-CmrdeZr-.js";import"./rc-tree-DVmHk75h.js";import"./rc-checkbox-D-wDgNrR.js";import"./rc-tooltip-BlYmnEaN.js";import"./rc-pagination-DWDFoAqY.js";import"./throttle-debounce-CXyDweCD.js";import"./rc-textarea-DTG7v55m.js";import"./@emotion-A5AG4Kgo.js";import"./stylis-1ato7xL_.js";import"./@kurkle-C2iixY9X.js";(function(){const s=document.createElement("link").relList;if(!(s&&s.supports&&s.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0})}function a(t){if(t.ep)return;t.ep=!0;const r=function(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}(t);fetch(t.href,r)}})();const{Header:xt}=R,bt=()=>e.jsx(xt,{className:"site-layout-background",style:{padding:0},children:e.jsx("h1",{style:{textAlign:"left",paddingLeft:"20px"},children:"眾資成城-在你心愛的餐廳成為合夥人"})}),{Sider:yt}=R,jt=[{key:"/",icon:e.jsx(et,{}),label:e.jsx(W,{to:"/",children:"首頁"})},{key:"/profile",icon:e.jsx(ke,{}),label:e.jsx(W,{to:"/profile",children:"會員管理"})},{key:"/raising-deals",icon:e.jsx(tt,{}),label:e.jsx(W,{to:"/raising-deals",children:"募集交易管理"})},{key:"/news",icon:e.jsx(at,{}),label:e.jsx(W,{to:"/news",children:"公告活動管理"})},{key:"/settings",icon:e.jsx(st,{}),label:e.jsx(W,{to:"/settings",children:"設定"})}],ft=()=>{const s=Xe().pathname;return e.jsx(yt,{children:e.jsx(Qe,{theme:"dark",mode:"inline",items:jt,selectedKeys:[s]})})},{Content:kt}=R,vt=({children:s})=>e.jsxs(R,{style:{minHeight:"100vh"},children:[e.jsx(ft,{}),e.jsxs(R,{className:"site-layout",children:[e.jsx(bt,{}),e.jsx(kt,{style:{margin:"16px"},children:e.jsx("div",{style:{padding:24,background:"#fff"},children:s})})]})]});J.register(pe,me,ct,ut,ge,X,Z);const St=()=>e.jsx(lt,{data:{labels:["一月","二月","三月","四月","五月","六月","七月"],datasets:[{label:"交易量",data:[65,59,80,81,56,55,40],fill:!1,borderColor:"rgba(75,192,192,1)",tension:.1}]},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"折線圖示例"}}}});J.register(pt,X,Z);const It=()=>e.jsx(dt,{data:{labels:["會員數量","專案量","系統消息"],datasets:[{label:"數量",data:[1234,5e3,321],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"會員數量、專案量和系統消息的圓餅圖"}}}});J.register(pe,me,Ce,ge,X,Z);const Ct=()=>e.jsx(Ie,{data:{labels:["台灣料理","韓式料理","日本料理","美式料理","泰式料理"],datasets:[{label:"料理數量",data:[12,19,3,5,2],backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)"],borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"各類料理數量的柱狀圖"}}}});J.register(pe,me,Ce,ge,X,Z);const wt=()=>e.jsx(Ie,{data:{labels:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],datasets:[{label:"收入",data:[5e3,6e3,7e3,8e3,7500,8500,9e3,9500,1e4,10500,11e3,11500],backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgba(75, 192, 192, 1)",borderWidth:1},{label:"支出",data:[3e3,4e3,3500,4500,4e3,5e3,5500,6e3,6500,7e3,7500,8e3],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"月財政報表"}}}}),ye=()=>e.jsxs("div",{children:[e.jsxs(ne,{gutter:16,children:[e.jsx(O,{span:8,children:e.jsxs(ie,{style:{display:"flex",alignItems:"center",padding:0},styles:{body:{display:"flex",alignItems:"center",padding:"16px",width:"100%"}},children:[e.jsx("div",{style:{backgroundColor:"#1890ff",padding:"16px",color:"#fff",marginRight:"auto"},children:e.jsx(ke,{style:{fontSize:"24px"}})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"24px",color:"#1890ff"},children:"1234"}),e.jsx("div",{children:"會員總量"})]})]})}),e.jsx(O,{span:8,children:e.jsxs(ie,{style:{display:"flex",alignItems:"center",padding:0},styles:{body:{display:"flex",alignItems:"center",padding:"16px",width:"100%"}},children:[e.jsx("div",{style:{backgroundColor:"#52c41a",padding:"16px",color:"#fff",marginRight:"auto"},children:e.jsx(rt,{style:{fontSize:"24px"}})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"24px",color:"#52c41a"},children:"321"}),e.jsx("div",{children:"系統消息"})]})]})}),e.jsx(O,{span:8,children:e.jsxs(ie,{style:{display:"flex",alignItems:"center",padding:0},styles:{body:{display:"flex",alignItems:"center",padding:"16px",width:"100%"}},children:[e.jsx("div",{style:{backgroundColor:"#f5222d",padding:"16px",color:"#fff",marginRight:"auto"},children:e.jsx(nt,{style:{fontSize:"24px"}})}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx("div",{style:{fontSize:"24px",color:"#f5222d"},children:"5000"}),e.jsx("div",{children:"專案總量"})]})]})})]}),e.jsxs(ne,{children:[e.jsx(O,{span:12,children:e.jsx(St,{})}),e.jsx(O,{span:6,children:e.jsx(It,{})})]}),e.jsxs(ne,{children:[e.jsx(O,{span:12,children:e.jsx(Ct,{})}),e.jsx(O,{span:12,children:e.jsx(wt,{})})]})]}),Lt=({setSearch:s,isLoading:a})=>e.jsx(e.Fragment,{children:e.jsx(ue.Search,{disabled:a,onSearch:t=>{console.log("value:",t),s(t)},size:"large",placeholder:"搜尋",enterButton:!0,allowClear:!0})}),A=class A{constructor(){}static getInstance(){return A.instance||(A.instance=new A),A.instance}setItem(a,t){localStorage.setItem(a,t)}getItem(a){return localStorage.getItem(a)}removeItem(a){localStorage.removeItem(a)}clear(){localStorage.clear()}};xe(A,"instance");let ce=A;const oe=ce.getInstance(),_e=({data:s,name:a,columns:t,isLoading:r,setSearch:i,currentPage:o,pageSize:u,total:x,handlePageChange:I,children:L})=>{const k=t.map(p=>p.key),[C,F]=c.useState(oe.getItem(`${a}filteredColumns`)?JSON.parse(oe.getItem(`${a}filteredColumns`)):k),D=t.map(({key:p,title:h})=>({label:h,value:p})),E=c.useMemo(()=>{const p=t.filter(h=>C.includes(h.key));return oe.setItem(`${a}filteredColumns`,JSON.stringify(C)),p},[t,C,a]).map(p=>({...p,sorter:(h,m)=>typeof h[p.key]=="number"&&typeof m[p.key]=="number"?h[p.key]-m[p.key]:String(h[p.key]).localeCompare(String(m[p.key]))}));return e.jsxs(e.Fragment,{children:[e.jsx($e,{children:a}),e.jsxs(K,{direction:"vertical",size:"large",children:[e.jsx(Lt,{isLoading:r,setSearch:i}),L,e.jsx(Ke.Group,{disabled:r,value:C,options:D,onChange:p=>{F(p)}})]}),e.jsx(Re,{columns:E,dataSource:s.map((p,h)=>({...p,key:h})),loading:r,style:{marginTop:24},pagination:{current:o,pageSize:u,total:x,onChange:I}})]})},{Option:Et}=je,_t=({options:s=[],name:a})=>{const{control:t}=M();return e.jsx(V,{name:a,control:t,render:({field:r,fieldState:{error:i,isTouched:o}})=>e.jsx(z.Item,{validateStatus:i&&o?"error":"",help:i&&o?i.message:"",children:e.jsx(je,{...r,onChange:u=>r.onChange(u),value:r.value,children:s.map(u=>e.jsx(Et,{value:u.value,children:u.label},u.value))})})})},Ft=({options:s=[],name:a})=>{const{control:t}=M();return e.jsx(V,{name:a,control:t,render:({field:r,fieldState:{error:i,isTouched:o}})=>e.jsx(z.Item,{validateStatus:i&&o?"error":"",help:i&&o?i.message:"",children:e.jsx($.Group,{...r,options:s,onChange:u=>r.onChange(u.target.value),value:r.value})})})},Dt=({name:s,required:a=!1})=>{const{control:t}=M();return e.jsx(V,{name:s,control:t,render:({field:r})=>e.jsx(z.Item,{required:a,children:e.jsx(Ue,{...r,style:{width:"100%"},value:r.value?T(r.value):null,presets:[{label:"1960",value:T().year(1960)},{label:"1970",value:T().year(1970)},{label:"1980",value:T().year(1980)},{label:"1990",value:T().year(1990)},{label:"2000",value:T().year(2e3)},{label:"2010",value:T().year(2010)},{label:"2020",value:T().year(2020)}],onChange:i=>{r.onChange(i?i.format("YYYY-MM-DD"):null)}})})})},Bt=({name:s})=>{const{control:a}=M();return e.jsx(V,{name:s,control:a,render:({field:t,fieldState:{error:r,isTouched:i}})=>e.jsx(z.Item,{validateStatus:r&&i?"error":"",help:r&&i?r.message:"",children:e.jsx(Tt,{...t,autoSize:{minRows:3,maxRows:5}})})})},{TextArea:Tt}=ue,Pt=({name:s})=>{const{control:a}=M();return e.jsx(V,{name:s,control:a,render:({field:t,fieldState:{error:r,isTouched:i}})=>e.jsx(z.Item,{validateStatus:r&&i?"error":"",help:r&&i?r.message:"",children:e.jsx(H,{...t,checkedChildren:"開啟",unCheckedChildren:"關閉",defaultChecked:!0})})})},Ot=Ye.memo(({name:s="",label:a,required:t=!1,type:r="text",options:i=[]})=>{if(!r)throw new Error(`Invalid type: ${r}. Expected 'text'.`);const{control:o}=M(),u=x=>{switch(r){case"number":return e.jsx(Ge,{...x,style:{width:"100%"}});case"select":return e.jsx(_t,{name:s,label:a,required:t,options:i});case"radio":return e.jsx(Ft,{name:s,required:t,options:i,field:x,label:a});case"textarea":return e.jsx(Bt,{label:a,name:s});case"switch":return e.jsx(Pt,{label:a,name:s});case"date":return e.jsx(Dt,{name:s,label:a,required:t});default:return e.jsx(ue,{...x,type:r})}};return e.jsx(V,{name:s,control:o,render:({field:x,fieldState:{error:I,isTouched:L}})=>e.jsx(z.Item,{label:a,required:t,validateStatus:I&&L?"error":"",help:I&&L?I.message:"",children:u(x)})})}),At=({formItems:s,initialValues:a})=>e.jsx(z,{layout:"vertical",autoComplete:"off",initialValues:a,children:s.map(t=>e.jsx(Ot,{...t},t.name))}),qt=({showModal:s,btnTitle:a,isLoading:t})=>e.jsx(U,{disabled:t,type:"primary",onClick:s,icon:e.jsx(it,{}),children:a}),Fe=({btnTitle:s,formItems:a,initialValues:t,createData:r,updateData:i,dialogState:o,updateIsOpen:u,isLoading:x})=>{const{formState:{isValid:I,isDirty:L},reset:k,handleSubmit:C,trigger:F}=M(),[D,E]=c.useState(!1),[p,h]=c.useState(!1);c.useEffect(()=>{E(D)},[I,L,D]),c.useEffect(()=>{o.currentItem?k(o.currentItem):k(t)},[o.currentItem,k,t]);const m=c.useCallback(()=>{h(!1),u({isOpen:!1,currentItem:null,isEdit:!1}),k(),E(!1)},[h,u,k,E]),j=c.useCallback(()=>{m()},[m]),y=c.useCallback(()=>{E(!1),h(!1)},[]),v=c.useCallback(async g=>{var b;h(!0),o.currentItem?i({id:(b=o.currentItem)==null?void 0:b.id,...g},{onSuccess:j,onError:y}):r(g,{onSuccess:j,onError:y})},[r,j,y,o.currentItem,i]),l=c.useMemo(()=>e.jsx(At,{formItems:a,initialValues:t}),[a,t]);return e.jsxs(e.Fragment,{children:[e.jsx(qt,{isLoading:x,showModal:()=>{u({isOpen:!0,currentItem:null,isEdit:!1}),F(),k(t),console.log("reset:",t)},btnTitle:s}),e.jsx(fe,{title:o.isEdit?"編輯資料":"新增資料",cancelText:"取消",okText:"確定",onOk:async()=>{await F()&&C(v)()},maskClosable:!1,open:o.isOpen,onCancel:()=>{u({isOpen:!1,currentItem:null,isEdit:!1}),k()},okButtonProps:{disabled:!(I&&L)||p},cancelButtonProps:{disabled:p},children:l})]})};function f(s,a,t){["新增資料成功","新增資料失敗","修改資料成功","修改資料失敗","刪除資料成功","刪除資料失敗","資料格式無效","黑名單成功","黑名單失敗"].includes(t);const r=t;He[s]({message:a,description:r})}function ee(s,a){const t=s.safeParse(a);if(!t.success)throw f("error","失敗","資料格式無效"),console.error("資料格式無效zod",t.error),new Error("資料格式無效");return t.data}const De=(s=1,a=10)=>{const[t,r]=c.useState(s),[i,o]=c.useState(a);return{currentPage:t,pageSize:i,handlePageChange:(u,x)=>{r(u),x&&o(x)}}},_=ht.create({baseURL:"https://foodiefund.onrender.com/v1/api",headers:{"Content-Type":"application/json"}}),q=n.object({_id:n.string(),name:n.string().nonempty("姓名不能為空"),email:n.string().nonempty("電子郵箱不能為空").email("電子郵箱格式錯誤"),phone:n.string().optional().refine(s=>!s||/^\d{10}$/.test(s),{message:"電話號碼必須是10位數字或為空"}),address:n.string().optional(),dateOfBirth:n.string().optional(),role:n.string().optional(),remarks:n.string().optional(),isBlackListed:n.boolean().optional()}),zt=q.omit({role:!0,isBlackListed:!0}).extend({password:n.string().nonempty("密碼不能為空").min(8,"密碼不能少於8個字")});n.array(q),q.pick({_id:!0}),q.pick({_id:!0,isBlackListed:!0}),n.object({keyWord:n.string().optional(),page:n.number().optional(),limit:n.number().optional(),isBlackListed:n.union([n.number(),n.undefined()]).optional(),role:n.string().optional()});const Mt=n.object({success:n.boolean(),data:n.array(q),message:n.string(),pagination:n.object({current_page:n.number(),has_next:n.boolean(),has_pre:n.boolean(),total:n.number(),total_pages:n.number()})}),Nt=s=>Ee({queryKey:["Account",s],queryFn:async()=>{const a=await(({keyWord:r="",page:i,limit:o=10,isBlackListed:u,role:x=""})=>_.get("/admin/account",{params:{keyWord:r,page:i,limit:o,isBlackListed:u,role:x}}))(s),t=ee(Mt,a.data);return console.log("get users success",t),t}}),Yt=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,_.post("/auth/sign_up",t));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["Account"]}),f("success","新增成功","新增資料成功")},onError:a=>{var t,r;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),f("error","新增失敗",(r=a.response)==null?void 0:r.data.message)}})},Vt=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,console.log(t),_.put(`/admin/account/${t._id}`,t));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["Account"]}),f("success","修改成功","修改資料成功")},onError:a=>{var t,r;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),f("error","修改失敗",(r=a.response)==null?void 0:r.data.message)}})},Wt=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,_.delete(`/Admin/account/${t}`));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["Account"]}),f("success","刪除成功","刪除資料成功")},onError:a=>{var t,r;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),f("error","刪除失敗",(r=a.response)==null?void 0:r.data.message)}})},Qt=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,_.patch(`/admin/account/blacklist/${t._id}`,{isBlackListed:t.isBlackListed===!0?1:0}));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["Account"]}),f("success","修改成功","修改成功")},onError:a=>{var t,r;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),f("error","修改失敗",(r=a.response)==null?void 0:r.data.message)}})},{confirm:$t}=fe,Be=({_id:s,title:a,text:t,deleteData:r})=>{$t({title:`您確定刪除該${a}資料嗎?`,icon:e.jsx(ot,{style:{color:"#ff4d4f"}}),content:t,okText:"刪除",okType:"danger",cancelText:"取消",onOk(){r(s)},onCancel(){console.log("Cancel")}})},Te=(s,a)=>{var t;c.useEffect(()=>{var r;(r=s.data)!=null&&r.data&&a(s.data.data)},[(t=s.data)==null?void 0:t.data,a])},Kt=[{value:void 0,label:"全部"},{value:1,label:"黑名單"},{value:0,label:"白名單"}],Rt=[{value:"",label:"全部"},{value:"user",label:"User"},{value:"admin",label:"Admin"}],Ut=({setBlackListedFilter:s,setIsAdminFilter:a,isLoading:t})=>e.jsxs(Je,{vertical:!0,gap:"middle",children:[e.jsx($.Group,{disabled:t,defaultValue:void 0,buttonStyle:"solid",onChange:r=>{s(r.target.value)},children:Kt.map(r=>e.jsx($.Button,{value:r.value,children:r.label},String(r.value??"all")))}),e.jsx($.Group,{disabled:t,defaultValue:"",buttonStyle:"solid",onChange:r=>{a(r.target.value)},children:Rt.map(r=>e.jsx($.Button,{value:r.value,children:r.label},String(r.value)))})]}),Gt=()=>{var v;const{getUsersQuery:s,setSearch:a,createData:t,updateData:r,deleteData:i,initialValues:o,formItems:u,handlePageChange:x,currentPage:I,pageSize:L,dialogState:k,updateIsOpen:C,setBlackListedFilter:F,blackListedFilter:D,blackList:E,setIsAdminFilter:p}=(()=>{const{currentPage:l,pageSize:g,handlePageChange:b}=De(),[w,S]=c.useState(void 0),[d,P]=c.useState(""),[B,te]=c.useState({isOpen:!1,currentItem:null,isEdit:!1}),[ae,se]=c.useState(""),Pe=Nt({keyWord:ae,page:l,limit:g,isBlackListed:w,role:d}),{mutate:Oe}=Yt(),{mutate:Ae}=Vt(),{mutate:qe}=Wt(),{mutate:ze}=Qt(),he=[{name:"name",label:"姓名",required:!0,type:"text"},{name:"email",label:"信箱",type:"email",required:!0},{name:"password",label:"密碼",type:"password",required:!0},{name:"dateOfBirth",label:"生日",type:"date"},{name:"phone",label:"電話",type:"text"},{name:"address",label:"地址",type:"text"},{name:"remarks",label:"備註",type:"text"}];return{getUsersQuery:Pe,dialogState:B,updateIsOpen:re=>{te(re)},setSearch:se,createData:Oe,updateData:Ae,deleteData:qe,blackList:ze,initialValues:c.useMemo(()=>({_id:"",name:"",email:"",password:"",date_of_birth:"",phone:"",address:"",remarks:""}),[]),formItems:B.isEdit?[...he.filter(re=>re.name!=="password"),{name:"role",label:"角色",type:"select",options:[{label:"user",value:"user"},{label:"admin",value:"admin"}]}]:he,handlePageChange:b,currentPage:l,pageSize:g,setBlackListedFilter:S,blackListedFilter:w,setIsAdminFilter:P}})(),h=we({mode:"all",criteriaMode:"all",resolver:k.isEdit?le(q):le(zt)}),[m,j]=c.useState([]);Te(s,j);const y=((l,g,b,w,S)=>[{title:"姓名",dataIndex:"name",key:"name",sorter:!0,render:d=>e.jsxs("a",{children:[" ",d]})},{title:"信箱",dataIndex:"email",key:"email",sorter:!0},{title:"電話",dataIndex:"phone",key:"phone",sorter:!0},{title:"地址",dataIndex:"address",key:"address",sorter:!0},{title:"生日",dataIndex:"dateOfBirth",key:"dateOfBirth",sorter:!0,render:d=>de(d).format("YYYY-MM-DD")},{title:"角色",dataIndex:"role",key:"role",sorter:!0,render:d=>d==="user"?e.jsx(be,{color:"success",children:d}):e.jsx(be,{color:"error",children:d})},{title:"備註",dataIndex:"remarks",key:"remarks",sorter:!0},{title:"操作",dataIndex:"",key:"",render:d=>e.jsxs(K,{children:[e.jsx(U,{disabled:S,icon:e.jsx(ve,{}),onClick:()=>l(d)}),e.jsx(U,{disabled:S,danger:!0,icon:e.jsx(Se,{}),onClick:()=>g(d)}),b===void 0?null:e.jsx(H,{disabled:S,checkedChildren:"黑名單",unCheckedChildren:"白名單",checked:d.isBlackListed===!0,onChange:P=>w(P,d),loading:S})]})}])(l=>{console.log(l);const g=ee(q,l);C({isOpen:!0,currentItem:g,isEdit:!0})},l=>{Be({title:l.name,_id:l._id,deleteData:i})},D,(l,g)=>{((b,w,S,d)=>{S(P=>P.map(B=>B._id===w._id?{...B,isBlackListed:b}:B)),d({_id:w._id,isBlackListed:b})})(l,g,j,E)},s.isFetching);return e.jsx(Le,{...h,children:e.jsxs("div",{children:[e.jsx(Fe,{btnTitle:"新增資料",formItems:u,initialValues:o,createData:t,updateData:r,dialogState:k,updateIsOpen:C,isLoading:s.isFetching}),e.jsx(_e,{name:"會員列表",data:m??[],columns:y,isLoading:s.isFetching,setSearch:a,currentPage:I,pageSize:L,total:((v=s.data)==null?void 0:v.pagination.total)??0,handlePageChange:x,children:e.jsx(Ut,{setBlackListedFilter:F,setIsAdminFilter:p,isLoading:s.isFetching})})]})})},Ht=()=>e.jsx("div",{children:"Settings Page Content"}),G=n.object({_id:n.string(),title:n.string().optional(),content:n.string().optional(),isEnabled:n.boolean().optional(),isTop:n.boolean().optional(),publicAt:n.string().optional(),updateAt:n.string().optional(),id:n.string().optional()});G.pick({_id:!0}),n.array(G),n.object({keyWord:n.string().optional(),page:n.number().optional(),limit:n.number().optional()});const Jt=n.object({success:n.boolean(),data:n.array(G),message:n.string(),pagination:n.object({current_page:n.number(),has_next:n.boolean(),has_pre:n.boolean(),total:n.number(),total_pages:n.number()})}),Xt=s=>Ee({queryKey:["News",s],queryFn:async()=>{const a=await(({keyWord:r="",page:i,limit:o=10})=>_.get("/news",{params:{keyWord:r,page:i,limit:o}}))(s),t=ee(Jt,a.data);return console.log("get News success",t),t}}),Zt=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,_.post("/news/admin",t));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["News"]}),f("success","新增成功","新增資料成功")},onError:a=>{var t,r;console.error("Error creating News:",(t=a.response)==null?void 0:t.data.message),f("error","新增失敗",(r=a.response)==null?void 0:r.data.message)}})},ea=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,console.log(t),_.put(`/news/admin/${t._id}`,t));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["News"]}),f("success","修改成功","修改資料成功")},onError:a=>{var t,r;console.error("Error creating News:",(t=a.response)==null?void 0:t.data.message),f("error","修改失敗",(r=a.response)==null?void 0:r.data.message)}})},ta=()=>{const s=N();return Y({mutationFn:async a=>{return await(t=a,_.delete(`/news/admin/${t}`));var t},onSuccess:()=>{s.invalidateQueries({queryKey:["News"]}),f("success","刪除成功","刪除資料成功")},onError:a=>{var t,r;console.error("Error creating News:",(t=a.response)==null?void 0:t.data.message),f("error","刪除失敗",(r=a.response)==null?void 0:r.data.message)}})},aa=()=>{var h;const{getNewsQuery:s,setSearch:a,createData:t,updateData:r,deleteData:i,initialValues:o,formItems:u,handlePageChange:x,currentPage:I,pageSize:L,dialogState:k,updateIsOpen:C}=(()=>{const{currentPage:m,pageSize:j,handlePageChange:y}=De(),[v,l]=c.useState(void 0),[g,b]=c.useState({isOpen:!1,currentItem:null,isEdit:!1}),[w,S]=c.useState(""),d=Xt({keyWord:w,page:m,limit:j}),{mutate:P}=Zt(),{mutate:B}=ea(),{mutate:te}=ta(),ae=[{name:"title",label:"標題",type:"text"},{name:"content",label:"內容",type:"textarea"},{name:"isEnabled",label:"是否啟用",type:"switch"},{name:"isTop",label:"是否置頂",type:"switch"}];return{getNewsQuery:d,dialogState:g,updateIsOpen:se=>{b(se)},setSearch:S,createData:P,updateData:B,deleteData:te,initialValues:c.useMemo(()=>({_id:"",title:"",content:"",isTop:!1,isEnabled:!0}),[]),formItems:(g.isEdit,ae),handlePageChange:y,currentPage:m,pageSize:j,setBlackListedFilter:l,blackListedFilter:v}})(),F=we({mode:"all",criteriaMode:"all",resolver:le(G)}),[D,E]=c.useState([]);Te(s,E);const p=((m,j,y,v)=>[{title:"標題",dataIndex:"title",key:"title",sorter:!0,render:l=>e.jsxs("a",{children:[" ",l]})},{title:"內容",dataIndex:"content",key:"content",sorter:!0},{title:"是否啟用",dataIndex:"isEnabled",key:"isEnabled",render:(l,g)=>e.jsx(K,{children:e.jsx(H,{disabled:y,checkedChildren:"啟用",unCheckedChildren:"未啟用",checked:l,onChange:b=>v(b,g,"isEnabled"),loading:y})})},{title:"是否置頂",dataIndex:"isTop",key:"isTop",render:(l,g)=>e.jsx(K,{children:e.jsx(H,{disabled:y,checkedChildren:"置頂",unCheckedChildren:"未置頂",checked:l,onChange:b=>v(b,g,"isTop"),loading:y})})},{title:"發表時間",dataIndex:"publicAt",key:"publicAt",sorter:!0,render:l=>de(l).format("YYYY-MM-DD")},{title:"更新時間",dataIndex:"updateAt",key:"updateAt",sorter:!0,render:l=>de(l).format("YYYY-MM-DD")},{title:"操作",dataIndex:"",key:"",render:l=>e.jsxs(K,{children:[e.jsx(U,{disabled:y,icon:e.jsx(ve,{}),onClick:()=>m(l)}),e.jsx(U,{disabled:y,danger:!0,icon:e.jsx(Se,{}),onClick:()=>j(l)})]})}])(m=>{console.log(m);const j=ee(G,m);C({isOpen:!0,currentItem:j,isEdit:!0})},m=>{Be({title:m.title,_id:m._id,deleteData:i})},s.isFetching,(m,j,y)=>{((v,l,g,b,w)=>{b==="isEnabled"?(console.log("isEnabled"),g(S=>S.map(d=>d._id===l._id?{...d,isEnabled:v}:d)),w({_id:l._id,isEnabled:v})):(console.log("isTop"),g(S=>S.map(d=>d._id===l._id?{...d,isTop:v}:d)),w({_id:l._id,isTop:v}))})(m,j,E,y,r)});return e.jsx(Le,{...F,children:e.jsxs("div",{children:[e.jsx(Fe,{btnTitle:"新增資料",formItems:u,initialValues:o,createData:t,updateData:r,dialogState:k,updateIsOpen:C,isLoading:s.isFetching}),e.jsx(_e,{name:"公告列表",data:D??[],columns:p,isLoading:s.isFetching,setSearch:a,currentPage:I,pageSize:L,total:((h=s.data)==null?void 0:h.pagination.total)??0,handlePageChange:x})]})})},sa=()=>e.jsx(We,{basename:"/foodiefund-admin",children:e.jsx(vt,{children:e.jsxs(Ze,{children:[e.jsx(Q,{path:"/",element:e.jsx(ye,{})}),e.jsx(Q,{path:"/profile",element:e.jsx(Gt,{})}),e.jsx(Q,{path:"news",element:e.jsx(aa,{})}),e.jsx(Q,{path:"/settings",element:e.jsx(Ht,{})}),e.jsx(Q,{path:"*",element:e.jsx(ye,{})})]})})}),ra=new mt,na=document.getElementById("root");Ve.createRoot(na).render(e.jsx(gt,{client:ra,children:e.jsx(c.StrictMode,{children:e.jsx(sa,{})})}));
