var re=Object.defineProperty;var se=(r,a,t)=>a in r?re(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t;var H=(r,a,t)=>(se(r,typeof a!="symbol"?a+"":a,t),t);import{j as e,r as c,a as ne}from"./react-Bi3d65_o.js";import{c as ie}from"./react-dom-DttoD7qq.js";import{L as q,B as oe}from"./react-router-dom-CNkp-S8u.js";import{L as A,M as le,I as X,D as de,S as Z,C as ce,F as ue,a as M,b as ee,R as _,c as me,T as pe,B as W,d as te,s as ge,e as R,f as he,g as xe}from"./antd-DwneK7ai.js";import{S as ye,T as je,U as fe,V as be,W as ke,X as ve,Y as Se,Z as Ie,_ as Ce}from"./@ant-design-C-y3O8YI.js";import{u as z,C as Y,b as Le,F as Be}from"./react-hook-form-DrtPsZaK.js";import{t as J}from"./@hookform-D0evxqJq.js";import{d as F}from"./dayjs-DIA0-yFM.js";import{u as Ee,a as $,b as N,Q as Fe,c as we}from"./@tanstack-BapjZGRO.js";import{a as Oe}from"./axios-B4HuQH-i.js";import{z as o}from"./zod-Y5dSNMtF.js";import{h as Pe}from"./moment-CNBjaTJc.js";import{d as De,e as T}from"./react-router-DeUjcAIS.js";import"./classnames-BaEkKJlL.js";import"./scheduler-DTKAQvWo.js";import"./@remix-run-CPHcqyyx.js";import"./rc-util-C7705Oj_.js";import"./@babel-D4-ut-Uz.js";import"./rc-resize-observer-B6_Tj1-Q.js";import"./resize-observer-polyfill-BT-ZEh6l.js";import"./rc-motion-C1KiqwsE.js";import"./rc-overflow-bPcnyqg5.js";import"./rc-picker-M4028Ejg.js";import"./@rc-component-DkdjcAXV.js";import"./rc-menu-iHApGxUz.js";import"./rc-select-IJuJy28y.js";import"./rc-virtual-list-MHoChsUk.js";import"./rc-input-number-B4gt17nH.js";import"./rc-input-CK5FyHxW.js";import"./@ctrl-YIyChsxa.js";import"./rc-field-form-DLWfUEiy.js";import"./scroll-into-view-if-needed-C9t9fFH4.js";import"./compute-scroll-into-view-DWa9QgjM.js";import"./rc-dialog-D9zpP1gB.js";import"./rc-notification-C2jgTedp.js";import"./rc-switch-37w2GYbv.js";import"./rc-table-CmrdeZr-.js";import"./rc-tree-DVmHk75h.js";import"./rc-checkbox-D-wDgNrR.js";import"./rc-dropdown-Cq_zp985.js";import"./rc-tooltip-BlYmnEaN.js";import"./rc-pagination-DWDFoAqY.js";import"./throttle-debounce-CXyDweCD.js";import"./rc-textarea-DTG7v55m.js";import"./@emotion-A5AG4Kgo.js";import"./stylis-1ato7xL_.js";(function(){const r=document.createElement("link").relList;if(!(r&&r.supports&&r.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0})}function a(t){if(t.ep)return;t.ep=!0;const s=function(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,s)}})();const{Header:qe}=A,Te=()=>e.jsx(qe,{className:"site-layout-background",style:{padding:0},children:e.jsx("h1",{style:{textAlign:"left",paddingLeft:"20px"},children:"眾資成城-在你心愛的餐廳成為合夥人"})}),{Sider:_e}=A,Ae=[{key:"home",icon:e.jsx(ye,{}),label:e.jsx(q,{to:"/",children:"首頁"})},{key:"profile",icon:e.jsx(je,{}),label:e.jsx(q,{to:"/profile",children:"會員管理"})},{key:"raising-deals",icon:e.jsx(fe,{}),label:e.jsx(q,{to:"/raising-deals",children:"募集交易管理"})},{key:"announcement",icon:e.jsx(be,{}),label:e.jsx(q,{to:"/announcement",children:"公告活動管理"})},{key:"settings",icon:e.jsx(ke,{}),label:e.jsx(q,{to:"/settings",children:"設定"})}],Me=()=>e.jsx(_e,{children:e.jsx(le,{theme:"dark",mode:"inline",items:Ae})}),{Content:ze}=A,Ve=({children:r})=>e.jsxs(A,{style:{minHeight:"100vh"},children:[e.jsx(Me,{}),e.jsxs(A,{className:"site-layout",children:[e.jsx(Te,{}),e.jsx(ze,{style:{margin:"16px"},children:e.jsx("div",{style:{padding:24,background:"#fff"},children:r})})]})]}),Ye=()=>e.jsx("div",{children:"Home"}),$e=({setSearch:r,isLoading:a})=>e.jsx(e.Fragment,{children:e.jsx(X.Search,{disabled:a,onSearch:t=>{console.log("value:",t),r(t)},size:"large",placeholder:"搜尋",enterButton:!0,allowClear:!0})}),O=class O{constructor(){}static getInstance(){return O.instance||(O.instance=new O),O.instance}setItem(a,t){localStorage.setItem(a,t)}getItem(a){return localStorage.getItem(a)}removeItem(a){localStorage.removeItem(a)}clear(){localStorage.clear()}};H(O,"instance");let G=O;const U=G.getInstance(),Ne=({data:r,name:a,columns:t,isLoading:s,setSearch:n,currentPage:i,pageSize:d,total:p,handlePageChange:f,children:b})=>{const h=t.map(l=>l.key),[v,C]=c.useState(U.getItem(`${a}filteredColumns`)?JSON.parse(U.getItem(`${a}filteredColumns`)):h),L=t.map(({key:l,title:u})=>({label:u,value:l})),S=c.useMemo(()=>{const l=t.filter(u=>v.includes(u.key));return U.setItem(`${a}filteredColumns`,JSON.stringify(v)),l},[t,v,a]).map(l=>({...l,sorter:(u,x)=>typeof u[l.key]=="number"&&typeof x[l.key]=="number"?u[l.key]-x[l.key]:String(u[l.key]).localeCompare(String(x[l.key]))}));return e.jsxs(e.Fragment,{children:[e.jsx(de,{children:a}),e.jsxs(Z,{direction:"vertical",size:"large",children:[e.jsx($e,{isLoading:s,setSearch:n}),b,e.jsx(ce.Group,{disabled:s,value:v,options:L,onChange:l=>{C(l)}})]}),e.jsx(ue,{columns:S,dataSource:r.map((l,u)=>({...l,key:u})),loading:s,style:{marginTop:24},pagination:{current:i,pageSize:d,total:p,onChange:f}})]})},{Option:Qe}=ee,Ke=({options:r=[],name:a})=>{const{control:t}=z();return e.jsx(Y,{name:a,control:t,render:({field:s,fieldState:{error:n,isTouched:i}})=>e.jsx(M.Item,{validateStatus:n&&i?"error":"",help:n&&i?n.message:"",children:e.jsx(ee,{...s,onChange:d=>s.onChange(d),value:s.value,children:r.map(d=>e.jsx(Qe,{value:d.value,children:d.label},d.value))})})})},Ue=({options:r=[],name:a})=>{const{control:t}=z();return e.jsx(Y,{name:a,control:t,render:({field:s,fieldState:{error:n,isTouched:i}})=>e.jsx(M.Item,{validateStatus:n&&i?"error":"",help:n&&i?n.message:"",children:e.jsx(_.Group,{...s,options:r,onChange:d=>s.onChange(d.target.value),value:s.value})})})},We=({name:r,required:a=!1})=>{const{control:t}=z();return e.jsx(Y,{name:r,control:t,render:({field:s})=>e.jsx(M.Item,{required:a,children:e.jsx(me,{...s,style:{width:"100%"},value:s.value?F(s.value):null,presets:[{label:"1960",value:F().year(1960)},{label:"1970",value:F().year(1970)},{label:"1980",value:F().year(1980)},{label:"1990",value:F().year(1990)},{label:"2000",value:F().year(2e3)},{label:"2010",value:F().year(2010)},{label:"2020",value:F().year(2020)}],onChange:n=>{s.onChange(n?n.format("YYYY-MM-DD"):null)}})})})},Ge=ne.memo(({name:r="",label:a,required:t=!1,type:s="text",options:n=[]})=>{if(!s)throw new Error(`Invalid type: ${s}. Expected 'text'.`);const{control:i}=z(),d=p=>{switch(s){case"number":return e.jsx(pe,{...p,style:{width:"100%"}});case"select":return e.jsx(Ke,{name:r,label:a,required:t,options:n});case"radio":return e.jsx(Ue,{name:r,required:t,options:n,field:p,label:a});case"date":return e.jsx(We,{name:r,label:a,required:t});default:return e.jsx(X,{...p,type:s})}};return e.jsx(Y,{name:r,control:i,render:({field:p,fieldState:{error:f,isTouched:b}})=>e.jsx(M.Item,{label:a,required:t,validateStatus:f&&b?"error":"",help:f&&b?f.message:"",children:d(p)})})}),He=({formItems:r,initialValues:a})=>e.jsx(M,{layout:"vertical",autoComplete:"off",initialValues:a,children:r.map(t=>e.jsx(Ge,{...t},t.name))}),Re=({showModal:r,btnTitle:a,isLoading:t})=>e.jsx(W,{disabled:t,type:"primary",onClick:r,icon:e.jsx(ve,{}),children:a}),Je=({btnTitle:r,formItems:a,initialValues:t,createData:s,updateData:n,dialogState:i,updateIsOpen:d,isLoading:p})=>{const{formState:{isValid:f,isDirty:b},reset:h,handleSubmit:v,trigger:C}=z(),[L,S]=c.useState(!1),[l,u]=c.useState(!1);c.useEffect(()=>{S(L)},[f,b,L]),c.useEffect(()=>{i.currentItem?h(i.currentItem):h(t)},[i.currentItem,h,t]);const x=c.useCallback(()=>{u(!1),d({isOpen:!1,currentItem:null,isEdit:!1}),h(),S(!1)},[u,d,h,S]),B=c.useCallback(()=>{x()},[x]),w=c.useCallback(()=>{S(!1),u(!1)},[]),D=c.useCallback(async g=>{var y;u(!0),i.currentItem?n({id:(y=i.currentItem)==null?void 0:y.id,...g},{onSuccess:B,onError:w}):s(g,{onSuccess:B,onError:w})},[s,B,w,i.currentItem,n]),m=c.useMemo(()=>e.jsx(He,{formItems:a,initialValues:t}),[a,t]);return e.jsxs(e.Fragment,{children:[e.jsx(Re,{isLoading:p,showModal:()=>{d({isOpen:!0,currentItem:null,isEdit:!1}),C(),h(t),console.log("reset:",t)},btnTitle:r}),e.jsx(te,{title:i.isEdit?"編輯資料":"新增資料",cancelText:"取消",okText:"確定",onOk:async()=>{await C()&&v(D)()},maskClosable:!1,open:i.isOpen,onCancel:()=>{d({isOpen:!1,currentItem:null,isEdit:!1}),h()},okButtonProps:{disabled:!(f&&b)||l},cancelButtonProps:{disabled:!(f&&b)||l},children:m})]})};function I(r,a,t){["新增資料成功","新增資料失敗","修改資料成功","修改資料失敗","刪除資料成功","刪除資料失敗","資料格式無效","黑名單成功","黑名單失敗"].includes(t);const s=t;ge[r]({message:a,description:s})}function ae(r,a){const t=r.safeParse(a);if(!t.success)throw I("error","失敗","資料格式無效"),console.error("資料格式無效zod",t.error),new Error("資料格式無效");return t.data}const V=Oe.create({baseURL:"https://foodiefund.onrender.com/v1/api",headers:{"Content-Type":"application/json"}}),P=o.object({_id:o.string(),name:o.string().nonempty("姓名不能為空"),email:o.string().nonempty("電子郵箱不能為空").email("電子郵箱格式錯誤"),phone:o.string().optional().refine(r=>!r||/^\d{10}$/.test(r),{message:"電話號碼必須是10位數字或為空"}),address:o.string().optional(),dateOfBirth:o.string().optional(),role:o.string().optional(),remarks:o.string().optional(),isBlackListed:o.boolean().optional()}),Xe=P.omit({role:!0,isBlackListed:!0}).extend({password:o.string().nonempty("密碼不能為空").min(8,"密碼不能少於8個字")});o.array(P),P.pick({_id:!0}),P.pick({_id:!0,isBlackListed:!0}),o.object({keyWord:o.string().optional(),page:o.number().optional(),limit:o.number().optional(),isBlackListed:o.union([o.number(),o.undefined()]).optional(),role:o.string().optional()});const Ze=o.object({data:o.array(P),message:o.string(),pagination:o.object({current_page:o.number(),has_next:o.boolean(),has_pre:o.boolean(),total:o.number(),total_pages:o.number()})}),et=r=>Ee({queryKey:["Account",r],queryFn:async()=>{const a=await(({keyWord:s="",page:n,limit:i=10,isBlackListed:d,role:p=""})=>V.get("/admin/account",{params:{keyWord:s,page:n,limit:i,isBlackListed:d,role:p}}))(r),t=ae(Ze,a.data);return console.log("get users success",t),t}}),tt=()=>{const r=$();return N({mutationFn:async a=>{return await(t=a,V.post("/auth/sign_up",t));var t},onSuccess:()=>{r.invalidateQueries({queryKey:["Account"]}),I("success","新增成功","新增資料成功")},onError:a=>{var t,s;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),I("error","新增失敗",(s=a.response)==null?void 0:s.data.message)}})},at=()=>{const r=$();return N({mutationFn:async a=>{return await(t=a,console.log(t),V.put(`/admin/account/${t._id}`,t));var t},onSuccess:()=>{r.invalidateQueries({queryKey:["Account"]}),I("success","修改成功","修改資料成功")},onError:a=>{var t,s;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),I("error","修改失敗",(s=a.response)==null?void 0:s.data.message)}})},rt=()=>{const r=$();return N({mutationFn:async a=>{return await(t=a,V.delete(`/Admin/account/${t}`));var t},onSuccess:()=>{r.invalidateQueries({queryKey:["Account"]}),I("success","刪除成功","刪除資料成功")},onError:a=>{var t,s;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),I("error","刪除失敗",(s=a.response)==null?void 0:s.data.message)}})},st=()=>{const r=$();return N({mutationFn:async a=>{return await(t=a,V.patch(`/admin/account/blacklist/${t._id}`,{isBlackListed:t.isBlackListed===!0?1:0}));var t},onSuccess:()=>{r.invalidateQueries({queryKey:["Account"]}),I("success","修改成功","修改成功")},onError:a=>{var t,s;console.error("Error creating user:",(t=a.response)==null?void 0:t.data.message),I("error","修改失敗",(s=a.response)==null?void 0:s.data.message)}})},nt=()=>{const{currentPage:r,pageSize:a,handlePageChange:t}=((x=1,B=10)=>{const[w,D]=c.useState(x),[m,g]=c.useState(B);return{currentPage:w,pageSize:m,handlePageChange:(y,k)=>{D(y),k&&g(k)}}})(),[s,n]=c.useState(void 0),[i,d]=c.useState(""),[p,f]=c.useState({isOpen:!1,currentItem:null,isEdit:!1}),[b,h]=c.useState(""),v=et({keyWord:b,page:r,limit:a,isBlackListed:s,role:i}),{mutate:C}=tt(),{mutate:L}=at(),{mutate:S}=rt(),{mutate:l}=st(),u=[{name:"name",label:"姓名",required:!0,type:"text"},{name:"email",label:"信箱",type:"email",required:!0},{name:"password",label:"密碼",type:"password",required:!0},{name:"dateOfBirth",label:"生日",type:"date"},{name:"phone",label:"電話",type:"text"},{name:"address",label:"地址",type:"text"},{name:"remarks",label:"備註",type:"text"}];return{getUsersQuery:v,dialogState:p,updateIsOpen:x=>{f(x)},setSearch:h,createData:C,updateData:L,deleteData:S,blackList:l,initialValues:c.useMemo(()=>({_id:"",name:"",email:"",password:"",date_of_birth:"",phone:"",address:"",remarks:""}),[]),formItems:p.isEdit?[...u.filter(x=>x.name!=="password"),{name:"role",label:"角色",type:"select",options:[{label:"user",value:"user"},{label:"admin",value:"admin"}]}]:u,handlePageChange:t,currentPage:r,pageSize:a,setBlackListedFilter:n,blackListedFilter:s,setIsAdminFilter:d}},{confirm:it}=te,ot=[{value:void 0,label:"全部"},{value:1,label:"黑名單"},{value:0,label:"白名單"}],lt=[{value:"",label:"全部"},{value:"user",label:"User"},{value:"admin",label:"Admin"}],dt=({setBlackListedFilter:r,setIsAdminFilter:a,isLoading:t})=>e.jsxs(xe,{vertical:!0,gap:"middle",children:[e.jsx(_.Group,{disabled:t,defaultValue:void 0,buttonStyle:"solid",onChange:s=>{r(s.target.value)},children:ot.map(s=>e.jsx(_.Button,{value:s.value,children:s.label},String(s.value??"all")))}),e.jsx(_.Group,{disabled:t,defaultValue:"",buttonStyle:"solid",onChange:s=>{a(s.target.value)},children:lt.map(s=>e.jsx(_.Button,{value:s.value,children:s.label},String(s.value)))})]}),ct=()=>{var D;const{getUsersQuery:r,setSearch:a,createData:t,updateData:s,deleteData:n,initialValues:i,formItems:d,handlePageChange:p,currentPage:f,pageSize:b,dialogState:h,updateIsOpen:v,setBlackListedFilter:C,blackListedFilter:L,blackList:S,setIsAdminFilter:l}=nt(),u=Le({mode:"all",criteriaMode:"all",resolver:h.isEdit?J(P):J(Xe)}),[x,B]=c.useState([]);((m,g)=>{var y;c.useEffect(()=>{var k;(k=m.data)!=null&&k.data&&g(m.data.data)},[(y=m.data)==null?void 0:y.data,g])})(r,B);const w=((m,g,y,k,E)=>[{title:"姓名",dataIndex:"name",key:"name",sorter:!0,render:j=>e.jsxs("a",{children:[" ",j]})},{title:"信箱",dataIndex:"email",key:"email",sorter:!0},{title:"電話",dataIndex:"phone",key:"phone",sorter:!0},{title:"地址",dataIndex:"address",key:"address",sorter:!0},{title:"生日",dataIndex:"dateOfBirth",key:"dateOfBirth",sorter:!0,render:j=>Pe(j).format("YYYY-MM-DD")},{title:"角色",dataIndex:"role",key:"role",sorter:!0,render:j=>j==="user"?e.jsx(R,{color:"success",children:j}):e.jsx(R,{color:"error",children:j})},{title:"備註",dataIndex:"remarks",key:"remarks",sorter:!0},{title:"操作",dataIndex:"",key:"",render:j=>e.jsxs(Z,{children:[e.jsx(W,{disabled:E,icon:e.jsx(Se,{}),onClick:()=>m(j)}),e.jsx(W,{disabled:E,danger:!0,icon:e.jsx(Ie,{}),onClick:()=>g(j)}),y===void 0?null:e.jsx(he,{disabled:E,checkedChildren:"黑名單",unCheckedChildren:"白名單",checked:j.isBlackListed===!0,onChange:Q=>k(Q,j),loading:E})]})}])(m=>{console.log(m);const g=ae(P,m);v({isOpen:!0,currentItem:g,isEdit:!0})},m=>{(({_id:g,title:y,text:k,deleteData:E})=>{it({title:`您確定刪除該${y}資料嗎?`,icon:e.jsx(Ce,{style:{color:"#ff4d4f"}}),content:k,okText:"刪除",okType:"danger",cancelText:"取消",onOk(){E(g)},onCancel(){console.log("Cancel")}})})({title:m.name,_id:m._id,deleteData:n})},L,(m,g)=>{((y,k,E,j)=>{E(Q=>Q.map(K=>K._id===k._id?{...K,isBlackListed:y}:K)),j({_id:k._id,isBlackListed:y})})(m,g,B,S)},r.isFetching);return e.jsx(Be,{...u,children:e.jsxs("div",{children:[e.jsx(Je,{btnTitle:"新增資料",formItems:d,initialValues:i,createData:t,updateData:s,dialogState:h,updateIsOpen:v,isLoading:r.isFetching}),e.jsx(Ne,{name:"會員列表",data:x??[],columns:w,isLoading:r.isFetching,setSearch:a,currentPage:f,pageSize:b,total:((D=r.data)==null?void 0:D.pagination.total)??0,handlePageChange:p,children:e.jsx(dt,{setBlackListedFilter:C,setIsAdminFilter:l,isLoading:r.isFetching})})]})})},ut=()=>e.jsx("div",{children:"Settings Page Content"}),mt=()=>e.jsx("h1",{children:"404 - Page Not Found"}),pt=()=>e.jsx("div",{children:"blockList"}),gt=()=>e.jsx(oe,{basename:"/foodiefund-admin",children:e.jsx(Ve,{children:e.jsxs(De,{children:[e.jsx(T,{path:"/",element:e.jsx(Ye,{})}),e.jsx(T,{path:"/profile",element:e.jsx(ct,{})}),e.jsx(T,{path:"blockList",element:e.jsx(pt,{})}),e.jsx(T,{path:"/settings",element:e.jsx(ut,{})}),e.jsx(T,{path:"*",element:e.jsx(mt,{})})]})})}),ht=new Fe,xt=document.getElementById("root");ie.createRoot(xt).render(e.jsx(we,{client:ht,children:e.jsx(c.StrictMode,{children:e.jsx(gt,{})})}));
